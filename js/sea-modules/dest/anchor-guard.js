define(function(require,exports,module){var swf=require("./anchor-swf");var Tools=require("./anchor-tools");module.exports={sfbox:$(".start-watch"),changeTimeBtn:$(".sftext"),timeList:$(".sf-times"),startWatchBtn:$("#watchButton"),clz:$(".start-watch .clz"),price:88800,contoiner:$(".guard-main"),init:function(data){var _this=this;var params=jQuery.parseJSON(data.params);var rtype=UIF.roomType;this.rtype=rtype;_this.price=eval("params."+rtype+".guard");$(".sfpeice").text("总价格"+_this.price*parseInt($(".sftext").text())+"K豆");this.sfbox=$(".start-watch");this.changeTimeBtn=$(".sftext");this.timeList=$(".sf-times");this.startWatchBtn=$("#watchButton");this.clz=$(".start-watch .clz");this.sta=$(".kais");this.getGuardList();this.changeEvent();this.startWatch()},getGuardList:function(data){htm="";var n=0;if(data!=null){data=data.sort(Tools.sortBy("grds",1));$.each(data,function(){n++;var _self=$(this);_self[0].grds=_self[0].grds;htm+='<li><div class="guardYou"><div class="gback glv1"><img src="'+_self[0].himage+'" class="img2"/>		                        <span class="img3">'+_self[0].days+'<br />\u5929</span>		                        <img src="/static_data/images_css/guardbox/'+_self[0].levelImage+'" class="img1"/>		                        </div>		                        <div class="gname"><a href="#"  title="'+decodeURIComponent(_self[0].name)+'">'+decodeURIComponent(_self[0].name)+"</a></div></div></li>"})}if(n<8){for(var k=1;k<=6-n;k++){htm+='<li><div class="no-circle"></div></li>'}}$(".gdnum").text(n+"/32");$(".guard-main ul").html(htm)},changeEvent:function(){var base=this;base.changeTimeBtn.on("mouseover",function(){base.timeList.show()});base.timeList.find("li").on("click",function(){var mon=$(this).attr("dv");var _price=mon*base.price;base.changeTimeBtn.text(mon);base.changeTimeBtn.text(mon);$(".sfpeice").text("总价格"+_price+"K豆");base.clzTimelist()});base.timeList.on("mouseleave",function(){$(this).hide()});base.clz.on("click",function(){base.sfbox.hide()});base.sta.on("click",function(){if(!UIF.handler.login){UIF.handler.loging();return}base.sfbox.show()});base.contoiner.on("click",".no-circle",function(){if(!UIF.handler.login){UIF.handler.loging();return}base.sfbox.show()});base.contoiner.on("mouseover","li .img1",function(ext){$(this).siblings(".img3").slideToggle(100)}).on("mouseleave","li .img1",function(ext){$(this).siblings(".img3").hide()})},startWatch:function(){var base=this;base.startWatchBtn.on("click",function(){UIF.handler.sendAddGuard({guardDT:base.changeTimeBtn.text(),rtype:base.rtype},function(data){var args=jQuery.parseJSON(data);if(args!=null&&args.resultStatus==200){Tools.dialog("\u5F00\u901A\u6210\u529F")}else{if(args.resultStatus==100){Tools.dialog("余额不足")}else{Tools.dialog(args.resultMessage)}}base.sfbox.hide()})})},refreshGuardList:function(data){this.getGuardList(data)},clzTimelist:function(){this.timeList.hide()},onMessage:function(data){swf.guardLevelup({guardLevel:data.grds,nickname:decodeURIComponent(data.name)})}}});