define(function(d,b,e){var a=d("cons");var f=d("./anchor-swf");var c=d("./anchor-tools");e.exports={oWidth:0,init:function(){$("#sendGiftBtn").click(function(){if(!UIF.handler.login){UIF.handler.loging();return}var w=parseInt($("#sendGiftNum").val());if(w==""){w=0}if(UIF.handler.newSendGiftID==0){c.dialog("\u8BF7\u9009\u62E9\u793C\u7269");return}if(w<=0||!$.isNumeric(w)){c.dialog("\u8BF7\u6B63\u786E\u586B\u5199\u793C\u7269\u6570\u91CF");return}var t=UIF.handler.cache.get(a.GIFT_TIMEGIFTIDS);var s=UIF.handler.cache.get(a.GIFT_TIMEUUIDS);var y=UIF.handler.cache.get(a.GIFT_TRANSTIME);var x=UIF.handler.cache.get(a.GIFT_TIMEGNUMBERS);var v=UIF.handler.cache.get(a.GIFT_TIMENUMBERS);if(t!=null&&s!=null&&y!=null&&v!=null&&x!=null&&t==UIF.handler.newSendGiftID&&x==w){var r=new Date().getTime();var u=r-y;if(u<=(5*1000)){v++;if(v==1){v++}y=new Date().getTime()}else{v=0;s=c.uuid();y=new Date().getTime()}}else{v=0;x=w;s=c.uuid();t=UIF.handler.newSendGiftID;y=new Date().getTime()}UIF.handler.cache.put(a.GIFT_TIMEUUIDS,s);UIF.handler.cache.put(a.GIFT_TRANSTIME,y);UIF.handler.cache.put(a.GIFT_TIMEGIFTIDS,t);UIF.handler.cache.put(a.GIFT_TIMEGNUMBERS,x);UIF.handler.cache.put(a.GIFT_TIMENUMBERS,v);UIF.handler.deduction({uid:s,sendNum:v,giftId:UIF.handler.newSendGiftID,number:w},function(B){var z=jQuery.parseJSON(B);if(z.resultStatus==100){var A='<div class="less-money">											                <div class="less-box">												            <div class="less-header">\u6E29\u99A8\u63D0\u793A</div>												            <div class="less-close"></div>												                <div class="hsr"></div>												                <div class="less-text">\u60A8\u7684<span>\u4F59\u989D</span>\u4E0D\u8DB3\uFF0C\u65E0\u6CD5\u8D2D\u4E70</div>												                <div class="less-butt">												                    <div class="less-charge butt"><a href="/pay.php">\u5145\u503C</a></div>												                    <div class="less-cancel butt">\u53D6\u6D88</div>												                </div>												            </div>												            </div>';$("body").append(A);$(".less-money").css({left:$(".newGifts").offset().left+400,top:$(".newGifts").offset().top-105});$(".less-money").show();return}c.dialog(z.resultMessage)})});$(".giveBtn").mousedown(function(){$(this).addClass("down")});$(".giveBtn").mouseup(function(){$(this).removeClass("down")});$("#stdSps li").click(function(){$("#sendGiftNum").val($(this).attr("data-count"));$("#stdSps").hide();return false});$("#giftShapeBtns").click(function(){$("#stdSps").toggle();return false});$("body").on("click",".less-close,.less-cancel",function(){$(".less-money").hide()});$(".giftHeader").on("click",".redot",function(){var r="";$.ajax({type:"POST",url:"/ajax/giftClick.php",data:"",dataType:"json",timeout:1200000,success:function(s){if(s==1){$(".giftHeader span:last").removeClass("redot")}},error:function(s,u,t){}})});$(".giftLists  li:not(:first)").mouseover(function(){var r;if($(this).find("div").attr("price")>0){r=$(this).find("img").attr("rel")+"</i>K豆"}else{r=""}if($(this).find("img").attr("join")>0){$(".gift-tip-popup").find(".gift-tip-info").html('<div class="gift-tip-pic"><img alt="'+$(this).find(".gfname").html()+'" src="'+$(this).find("img").attr("src")+'" class="'+$(this).find("img").attr("class")+'"/></div>                		<div class="gift-tip-detail"><p  class="gp1">'+$(this).find(".gfname").html()+"<i>"+r+'</p><p class="gp2">连送<i>2</i>组<i> '+$(this).find("img").attr("join")+"</i>，触发连击特效</p></div>")}else{$(".gift-tip-popup").find(".gift-tip-info").html('<div class="gift-tip-pic"><img alt="'+$(this).find(".gfname").html()+'" src="'+$(this).find("img").attr("src")+'" class="'+$(this).find("img").attr("class")+'"/></div><div class="gift-tip-detail"><p  class="gp1">'+$(this).find(".gfname").html()+"<i>"+r+"</p></div>")}if($(this).attr("giftnum")!=null){p3='<p  class="gp3">\u6570\u91CF\uFF1A'+$(this).attr("giftnum")+"</p>";$(".gift-tip-detail").append(p3)}$(".gift-tip-popup").show()}).mouseout(function(){$(".gift-tip-popup").hide()}).mousemove(function(t){var r=t.pageX;var s=t.pageY;$(".gift-tip-popup").css({left:r+40+"px",top:s-120+"px"})});if(UIF.handler.login){var l=0;var p=0;var g=c.getCookie("fi_time");var o=c.getCookie("fi_num");if(!g){c.setCookie("fi_time",300,86400);l=300}else{l=c.getCookie("fi_time")}if(!o){c.setCookie("fi_num",0,86400);p=0}else{p=c.getCookie("fi_num")}if(p>=50){clearInterval(h);$(".gift-tip-detail .gp22").text("今天获得星星已达上限!")}function q(){l--;$(".gift-tip-detail .gp22 i").text(l);c.setCookie("fi_time",l,86400);if(l<=0){l=300;if(p<50){p++}c.setCookie("fi_num",p,86400);$(".first-nus").text(p);UIF.handler.countingStar({},function(r){})}if(p>49){clearInterval(h);$(".gp22").text("今日星星已达上限")}}var h=setInterval(q,1000);$(".giftLists  li:first").mouseover(function(){if($(this).find(".first-nus").text()>49){var r="今日星星已达上限"}else{var r='<p class="gp22"><i> '+l+"</i>秒获取下一颗</p>"}$(".gift-tip-popup").find(".gift-tip-info").html('<div class="gift-tip-pic"><img alt="'+$(this).find(".gfname").html()+'" src="'+$(this).find("img").attr("src")+'" class="'+$(this).find("img").attr("class")+'"/></div>                     <div class="gift-tip-detail"><p  class="gp1">'+$(this).find(".gfname").html()+"<i> "+$(this).find(".first-nus").text()+"</i> 个</p>"+r+"</div>");if($(this).attr("giftnum")!=null){p3='<p  class="gp3">\u6570\u91CF\uFF1A'+$(this).attr("giftnum")+"</p>";$(".gift-tip-detail").append(p3)}$(".gift-tip-popup").show()}).mouseout(function(){$(".gift-tip-popup").hide()}).mousemove(function(t){var r=t.pageX;var s=t.pageY;$(".gift-tip-popup").css({left:r+40+"px",top:s-120+"px"})})}var n=0;var m=$(".xGiftList li").length;$(".giftHeader span").click(function(){$("#stdSps").hide();n=0;$(this).addClass("haselect");$(this).siblings().removeClass("haselect");$(".giftLists li").find("div").removeClass("intro");$(".giftLists ul").removeClass("xGiftList");$("#giftList"+$(this).attr("rel")).addClass("xGiftList");UIF.handler.newSendGiftID="";m=$(".xGiftList li").length;this.oWidth=m*(Math.ceil($(".xGiftList  li").width())+6)+5;this.oWidth=this.oWidth<384?384:this.oWidth;$(".xGiftList").css({width:this.oWidth,"margin-left":0})});$(".visualGiftList").on("mouseover","li div",function(s){var r=$(this).find("img");src=r[0].src;r.attr("src",src)}).on("mousedown","li div",function(r){if($(this).find("img").attr("types")=="0"){$("#giftShapeBtns").show()}else{$("#sendGiftNum").val(1);$("#giftShapeBtns").hide()}$(this).addClass("intro");gridimage=$(this).find("img");$(this).parent().siblings().find("div").removeAttr("choose").removeClass("intro");UIF.handler.newSendGiftID=$(this).attr("id").replace("gift","")}).on("mouseout","li div",function(s){var r=$(this).find("img");if(!r.hasClass("intro")){}});var j=0;var k=0;var i=0;this.oWidth=m*(Math.ceil($(".xGiftList  li").width())+8);k=6*($(".xGiftList  li").width()+6);j=Math.ceil(m/6);$(".xGiftList").css({width:this.oWidth});$(".giftContents").on("click",".toRight",function(){if(!(m>6)||(n-j)>=-1){return}i=parseInt($(".xGiftList").css("marginLeft"));$(".xGiftList").animate({"margin-left":i-k},300);n++});$(".giftContents").on("click",".toLeft",function(){if(n<1){return}i=parseInt($(".xGiftList").css("marginLeft"));$(".xGiftList").animate({"margin-left":i+k},300);n--})},filGift:function(g){f.fil({giftId:g.giftId,number:g.number,car:0})},figGift:function(j){var i="";var k="A";if((j.par!=undefined)&&(j.par!="")){var g=JSON.parse(j.par);k=g[j.number]}var h=j.giftId;switch(k){case"A":i="giftShape_"+j.number;h=h+".png";break;case"B":i="giftShape_"+j.number+"_3d";h=h+".png";break;case"C":i="giftShape_"+j.number+"_puzzle";h="big"+h+".swf";break}f.fig({image:h,shape:i})},customGift:function(g){f.cus({image:g.giftId,number:g.number})},sendGift:function(g){var i=[10,66,99,188,520,1314];if($.inArray(g.number,i)==-1&&g.giftType==0){g.giftType="-1"}switch(g.giftType){case"1":this.filGift(g);break;case"0":this.figGift(g);break;case"-1":this.customGift(g);break;default:break}if(g!=null&&g.par!=null&&g.par!=""){var h=JSON.parse(g.par);if(h!=null&&h.join!=null){if(g.number>=h.join){this.multyGift(g)}}}},multyGift:function(g){if(g.sendNum>0){f.mul({uid:g.uid,user:decodeURIComponent(g.user),number:g.number,sendNum:g.sendNum,headImg:UIF.cdn_img+"/"+g.avatar,giftImg:g.giftId})}},actGift:function(g){f.act({headImg:UIF.cdn_img+"/"+g.himage,actlevel:g.actlev})},cohGift:function(g){f.coh({headImg:UIF.cdn_img+"/"+g.himage,cohlevel:g.cohlevel,anhimg:UIF.cdn_img+"/"+g.anhimg})},speGift:function(g){f.spe({nickname:decodeURIComponent(g.nickname),speimg:"/static_data/images_css/upgrades/pic_consumelevel_"+g.splev+".png"})},enterCar:function(i){if(i.enterCar!=null){var k=jQuery.parseJSON(i.enterCar);var g="";if(k.carName==undefined||k.carName==""){g="\u8C6A\u8F66"}else{g=k.carName}var h="1";if(k.par!=null&&k.par!=""){var j=JSON.parse(k.par);if(j.flag=="1"){h="0"}}if(i.nickname==UIF.currentUserNickname){setTimeout(function(){f.fil({giftId:k.giftId,number:k.number,car:1,nickname:decodeURIComponent(i.nickname),carName:g,needAddFlag:h})},3*1000)}else{f.fil({giftId:k.giftId,number:k.number,car:1,nickname:decodeURIComponent(i.nickname),carName:g,needAddFlag:h})}}},interval:false,giftQueue:new Array(),sendRecord:function(m){if(m==null||m==undefined||m==""){return false}m.ctime=c.dateFormat(new Date(),"HH:mm");var g=this;var o='<span class="gr-ulevel {0}"></span>';var u=UIF.cdn_img+"/"+m.samllimg+"?p=0";var q='<li>						<div>						<span class="gr-time">'+c.dateFormat(new Date(),"HH:mm")+'</span>{0}						<span class="gr-sender">{1}</span>						<span class="gr-song">\u9001</span>{2}						<img src="{3}" />						<span class="color-green">{4}</span>						</div>						</li>';if(m!=null&&m.number!=""&&m.number>0){var t=new Array();for(var h=0;h<m.number;h++){t.push(h)}if(m.number>300){var r=new Array();r=t.slice(0,150);for(var h=m.number-150;h<m.number;h++){r.push(h)}t=r}var s="";$n="";$h="";for(var l=0;l<t.length;l++){s=c.stringFormat(u,m.giftId);$n=m.number==1?"":"X"+(t[l]+1);var k="";$touser="";if(m.spender!=null&&m.spender!=""&&m.spender.indexOf("pic_consumelevel_0")<0){k+=c.stringFormat(o,m.spender)}if(m.guards!=null&&m.guards!=""){k+=c.stringFormat(o,m.guards)}if(m.toUserName!=null&&m.toUserName!=""){$touser+=m.toUserName}$h=c.stringFormat(q,k,decodeURIComponent(m.user),decodeURIComponent($touser),s,$n);g.giftQueue.push($h)}var p;if(!g.interval){p=setInterval(j,50);g.interval=true}function j(){var i=g.giftQueue[0];g.giftQueue.splice(0,1);$("#movelist1").append(i);try{$("#nano-sendGiftList").nanoScroller();$("#nano-sendGiftList").nanoScroller({scroll:"bottom"})}catch(n){UIF.handler.weblog(n)}var v=$("#movelist1 li").length;if(v>50){$("#movelist1 li:lt("+(v-50)+")").remove()}if(g.giftQueue.length==0){clearInterval(p);g.interval=false}}}}}});